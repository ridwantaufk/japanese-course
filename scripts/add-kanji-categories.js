const { Pool } = require("pg");

const pool = new Pool({
  user: "postgres",
  password: "root",
  host: "localhost",
  port: 5432,
  database: "japanese_course",
});

// Kategori mapping berdasarkan makna kanji
const categoryKeywords = {
  "Makanan & Minuman": [
    "food",
    "eat",
    "drink",
    "rice",
    "meal",
    "tea",
    "sake",
    "fish",
    "meat",
    "vegetable",
    "fruit",
    "sweet",
    "taste",
    "cook",
    "dish",
    "soup",
    "salt",
    "sugar",
    "water",
    "milk",
    "bread",
    "noodle",
  ],
  "Tubuh & Kesehatan": [
    "body",
    "head",
    "eye",
    "ear",
    "nose",
    "mouth",
    "hand",
    "foot",
    "heart",
    "blood",
    "bone",
    "skin",
    "hair",
    "tooth",
    "health",
    "sick",
    "pain",
    "medicine",
    "doctor",
    "hospital",
  ],
  "Keluarga & Hubungan": [
    "family",
    "father",
    "mother",
    "parent",
    "child",
    "son",
    "daughter",
    "brother",
    "sister",
    "wife",
    "husband",
    "friend",
    "person",
    "people",
    "man",
    "woman",
    "baby",
    "old",
    "young",
    "marriage",
    "ancestor",
  ],
  "Alam & Cuaca": [
    "nature",
    "mountain",
    "river",
    "sea",
    "water",
    "fire",
    "wind",
    "rain",
    "snow",
    "cloud",
    "sky",
    "sun",
    "moon",
    "star",
    "tree",
    "flower",
    "grass",
    "forest",
    "stone",
    "earth",
    "weather",
    "hot",
    "cold",
    "season",
    "spring",
    "summer",
    "autumn",
    "winter",
  ],
  "Waktu & Tanggal": [
    "time",
    "day",
    "night",
    "morning",
    "evening",
    "hour",
    "minute",
    "second",
    "year",
    "month",
    "week",
    "today",
    "tomorrow",
    "yesterday",
    "past",
    "present",
    "future",
    "now",
    "before",
    "after",
    "early",
    "late",
  ],
  "Angka & Hitungan": [
    "one",
    "two",
    "three",
    "four",
    "five",
    "six",
    "seven",
    "eight",
    "nine",
    "ten",
    "hundred",
    "thousand",
    "number",
    "count",
    "many",
    "few",
    "all",
    "half",
    "double",
  ],
  "Tempat & Lokasi": [
    "place",
    "location",
    "town",
    "city",
    "village",
    "country",
    "house",
    "home",
    "room",
    "building",
    "shop",
    "store",
    "market",
    "school",
    "temple",
    "shrine",
    "station",
    "inside",
    "outside",
    "above",
    "below",
    "front",
    "back",
    "left",
    "right",
    "near",
    "far",
  ],
  "Transportasi & Perjalanan": [
    "car",
    "train",
    "bus",
    "ship",
    "airplane",
    "vehicle",
    "road",
    "bridge",
    "station",
    "travel",
    "journey",
    "go",
    "come",
    "arrive",
    "depart",
    "move",
    "walk",
    "run",
    "ride",
  ],
  "Pekerjaan & Profesi": [
    "work",
    "job",
    "office",
    "company",
    "business",
    "trade",
    "sell",
    "buy",
    "money",
    "price",
    "shop",
    "store",
    "worker",
    "teacher",
    "student",
    "doctor",
    "farmer",
    "merchant",
  ],
  "Pendidikan & Belajar": [
    "study",
    "learn",
    "school",
    "teacher",
    "student",
    "book",
    "read",
    "write",
    "test",
    "exam",
    "knowledge",
    "education",
    "science",
    "mathematics",
    "language",
    "history",
    "lesson",
    "practice",
  ],
  "Seni & Budaya": [
    "art",
    "music",
    "song",
    "dance",
    "picture",
    "paint",
    "color",
    "beauty",
    "beautiful",
    "culture",
    "tradition",
    "festival",
    "ceremony",
    "play",
    "game",
    "entertainment",
  ],
  "Emosi & Perasaan": [
    "emotion",
    "feeling",
    "happy",
    "sad",
    "angry",
    "fear",
    "love",
    "hate",
    "like",
    "dislike",
    "joy",
    "sorrow",
    "worry",
    "hope",
    "wish",
    "think",
    "believe",
    "remember",
    "forget",
  ],
  "Aksi & Aktivitas": [
    "do",
    "make",
    "action",
    "move",
    "use",
    "hold",
    "take",
    "give",
    "put",
    "open",
    "close",
    "cut",
    "pull",
    "push",
    "carry",
    "throw",
    "catch",
    "hit",
    "break",
    "fix",
  ],
  "Komunikasi & Bahasa": [
    "speak",
    "talk",
    "say",
    "tell",
    "ask",
    "answer",
    "call",
    "name",
    "word",
    "language",
    "letter",
    "writing",
    "listen",
    "hear",
    "sound",
    "voice",
    "news",
    "story",
    "question",
  ],
  "Ukuran & Sifat": [
    "big",
    "small",
    "long",
    "short",
    "high",
    "low",
    "wide",
    "narrow",
    "thick",
    "thin",
    "heavy",
    "light",
    "strong",
    "weak",
    "hard",
    "soft",
    "deep",
    "shallow",
    "new",
    "old",
    "good",
    "bad",
    "right",
    "wrong",
    "same",
    "different",
  ],
  "Warna & Tampilan": [
    "color",
    "white",
    "black",
    "red",
    "blue",
    "yellow",
    "green",
    "bright",
    "dark",
    "clear",
    "appearance",
    "shape",
    "form",
  ],
  "Negara & Politik": [
    "country",
    "nation",
    "king",
    "emperor",
    "government",
    "law",
    "rule",
    "war",
    "peace",
    "army",
    "soldier",
    "power",
    "authority",
    "capital",
    "state",
    "public",
  ],
  "Agama & Spiritual": [
    "god",
    "spirit",
    "soul",
    "heaven",
    "temple",
    "shrine",
    "pray",
    "worship",
    "sacred",
    "divine",
    "ceremony",
    "ritual",
    "buddhist",
    "shinto",
  ],
  Umum: [], // default category
};

// Jenis kata mapping berdasarkan makna kanji
const wordTypeKeywords = {
  "Kata Kerja": [
    "do",
    "make",
    "go",
    "come",
    "see",
    "look",
    "hear",
    "listen",
    "speak",
    "talk",
    "say",
    "tell",
    "eat",
    "drink",
    "sleep",
    "wake",
    "stand",
    "sit",
    "walk",
    "run",
    "buy",
    "sell",
    "give",
    "take",
    "use",
    "read",
    "write",
    "study",
    "learn",
    "teach",
    "work",
    "play",
    "cut",
    "open",
    "close",
    "enter",
    "exit",
    "start",
    "stop",
    "finish",
    "continue",
    "change",
    "move",
    "carry",
    "send",
    "receive",
    "meet",
    "leave",
    "arrive",
    "return",
    "fall",
    "rise",
    "grow",
    "die",
    "live",
    "born",
    "forget",
    "remember",
    "think",
    "know",
    "understand",
    "believe",
    "feel",
    "love",
    "hate",
    "like",
    "want",
    "need",
    "become",
    "happen",
    "exist",
    "appear",
    "disappear",
    "increase",
    "decrease",
    "help",
    "protect",
    "destroy",
    "create",
    "build",
    "break",
    "fix",
    "wash",
    "wear",
    "hold",
    "pull",
    "push",
    "throw",
    "catch",
    "hit",
    "kick",
    "touch",
    "smell",
    "taste",
    "cook",
    "burn",
    "boil",
    "freeze",
    "melt",
    "dry",
    "wet",
    "clean",
    "dirty",
    "mix",
    "separate",
    "join",
    "divide",
    "gather",
    "scatter",
    "choose",
    "decide",
    "try",
    "succeed",
    "fail",
    "win",
    "lose",
    "compete",
    "cooperate",
    "fight",
    "dance",
    "sing",
    "draw",
    "paint",
    "ride",
    "fly",
    "swim",
    "climb",
    "jump",
    "turn",
    "bend",
    "stretch",
    "press",
    "pull",
    "measure",
    "weigh",
    "count",
    "calculate",
    "compare",
    "examine",
    "investigate",
    "discover",
    "invent",
    "produce",
    "manufacture",
  ],
  "Kata Benda": [
    "thing",
    "object",
    "item",
    "person",
    "people",
    "man",
    "woman",
    "child",
    "baby",
    "boy",
    "girl",
    "father",
    "mother",
    "parent",
    "family",
    "friend",
    "teacher",
    "student",
    "worker",
    "body",
    "head",
    "face",
    "eye",
    "ear",
    "nose",
    "mouth",
    "hand",
    "foot",
    "heart",
    "place",
    "location",
    "house",
    "home",
    "room",
    "building",
    "town",
    "city",
    "village",
    "country",
    "mountain",
    "river",
    "sea",
    "tree",
    "flower",
    "plant",
    "animal",
    "bird",
    "fish",
    "insect",
    "food",
    "meal",
    "rice",
    "bread",
    "meat",
    "vegetable",
    "fruit",
    "water",
    "tea",
    "book",
    "paper",
    "letter",
    "word",
    "language",
    "name",
    "number",
    "money",
    "price",
    "clothes",
    "shoes",
    "tool",
    "machine",
    "car",
    "train",
    "ship",
    "airplane",
    "road",
    "street",
    "door",
    "window",
    "table",
    "chair",
    "bed",
    "box",
    "bag",
    "bottle",
    "shop",
    "store",
    "market",
    "school",
    "hospital",
    "temple",
    "station",
    "office",
    "company",
    "factory",
    "farm",
    "garden",
    "park",
    "bridge",
    "tower",
    "castle",
    "gate",
    "wall",
    "roof",
    "floor",
    "ground",
    "sky",
    "cloud",
    "sun",
    "moon",
    "star",
    "fire",
    "ice",
    "stone",
    "metal",
    "gold",
    "silver",
    "wood",
    "bamboo",
    "rice",
    "field",
    "thread",
    "cloth",
    "leather",
    "ball",
    "circle",
    "square",
    "line",
    "point",
    "center",
    "edge",
    "corner",
    "side",
    "part",
    "piece",
    "group",
    "set",
    "pair",
    "sound",
    "voice",
    "music",
    "song",
    "picture",
    "image",
    "color",
    "light",
    "shadow",
    "wind",
    "rain",
    "snow",
    "thunder",
    "lightning",
    "wave",
    "tide",
    "season",
    "spring",
    "summer",
    "autumn",
    "winter",
    "day",
    "night",
    "morning",
    "evening",
    "hour",
    "minute",
    "second",
    "year",
    "month",
    "week",
    "yesterday",
    "today",
    "tomorrow",
    "past",
    "present",
    "future",
    "beginning",
    "end",
    "top",
    "bottom",
    "front",
    "back",
    "inside",
    "outside",
    "way",
    "method",
    "style",
    "form",
    "shape",
    "size",
    "length",
    "width",
    "height",
    "depth",
    "weight",
    "strength",
    "power",
    "force",
    "energy",
    "speed",
    "direction",
    "distance",
    "degree",
    "amount",
    "quantity",
    "quality",
    "kind",
    "type",
    "class",
    "level",
    "grade",
    "rank",
    "order",
    "rule",
    "law",
    "principle",
    "theory",
    "idea",
    "thought",
    "opinion",
    "feeling",
    "emotion",
    "sense",
    "mind",
    "spirit",
    "soul",
    "life",
    "death",
    "birth",
    "age",
    "health",
    "disease",
    "illness",
    "pain",
    "medicine",
    "doctor",
    "patient",
    "reason",
    "cause",
    "result",
    "effect",
    "purpose",
    "goal",
    "plan",
    "problem",
    "question",
    "answer",
    "solution",
    "knowledge",
    "information",
    "news",
    "story",
    "history",
    "culture",
    "tradition",
    "custom",
    "ceremony",
    "festival",
    "celebration",
    "religion",
    "god",
    "buddha",
    "government",
    "nation",
    "state",
    "king",
    "emperor",
    "war",
    "peace",
    "army",
    "weapon",
    "trade",
    "business",
    "work",
    "job",
    "duty",
    "responsibility",
    "right",
    "authority",
    "permission",
    "promise",
    "contract",
    "agreement",
    "relationship",
    "connection",
    "difference",
    "similarity",
    "change",
    "progress",
    "development",
    "growth",
    "improvement",
    "decline",
    "increase",
    "decrease",
    "addition",
    "subtraction",
    "multiplication",
    "division",
    "calculation",
    "measurement",
    "experiment",
    "test",
    "examination",
    "research",
    "study",
    "investigation",
    "discovery",
    "invention",
    "creation",
    "production",
    "manufacture",
    "construction",
    "destruction",
    "repair",
    "maintenance",
    "use",
    "usage",
    "application",
    "practice",
    "training",
    "education",
    "lesson",
    "subject",
    "course",
    "exam",
    "grade",
    "degree",
    "certificate",
    "skill",
    "ability",
    "talent",
    "art",
    "technique",
    "game",
    "sport",
    "competition",
    "victory",
    "defeat",
    "prize",
    "reward",
    "punishment",
    "crime",
    "sin",
    "mistake",
    "error",
    "fault",
    "blame",
    "responsibility",
    "debt",
    "loan",
    "interest",
    "profit",
    "loss",
    "value",
    "worth",
    "importance",
    "meaning",
    "sense",
    "significance",
  ],
  "Kata Sifat": [
    "good",
    "bad",
    "beautiful",
    "ugly",
    "big",
    "small",
    "large",
    "little",
    "long",
    "short",
    "tall",
    "high",
    "low",
    "wide",
    "narrow",
    "thick",
    "thin",
    "heavy",
    "light",
    "strong",
    "weak",
    "hard",
    "soft",
    "rough",
    "smooth",
    "sharp",
    "dull",
    "hot",
    "cold",
    "warm",
    "cool",
    "new",
    "old",
    "young",
    "ancient",
    "modern",
    "early",
    "late",
    "fast",
    "slow",
    "quick",
    "rapid",
    "deep",
    "shallow",
    "near",
    "far",
    "close",
    "distant",
    "bright",
    "dark",
    "clear",
    "cloudy",
    "clean",
    "dirty",
    "pure",
    "impure",
    "fresh",
    "stale",
    "wet",
    "dry",
    "full",
    "empty",
    "rich",
    "poor",
    "expensive",
    "cheap",
    "valuable",
    "worthless",
    "important",
    "unimportant",
    "necessary",
    "unnecessary",
    "useful",
    "useless",
    "easy",
    "difficult",
    "hard",
    "simple",
    "complex",
    "complicated",
    "clear",
    "unclear",
    "obvious",
    "obscure",
    "certain",
    "uncertain",
    "sure",
    "doubtful",
    "possible",
    "impossible",
    "correct",
    "incorrect",
    "right",
    "wrong",
    "true",
    "false",
    "real",
    "fake",
    "natural",
    "artificial",
    "normal",
    "abnormal",
    "ordinary",
    "extraordinary",
    "common",
    "rare",
    "usual",
    "unusual",
    "regular",
    "irregular",
    "straight",
    "crooked",
    "flat",
    "steep",
    "level",
    "uneven",
    "horizontal",
    "vertical",
    "parallel",
    "perpendicular",
    "round",
    "square",
    "triangular",
    "circular",
    "happy",
    "sad",
    "joyful",
    "sorrowful",
    "glad",
    "unhappy",
    "cheerful",
    "gloomy",
    "pleasant",
    "unpleasant",
    "comfortable",
    "uncomfortable",
    "peaceful",
    "troubled",
    "calm",
    "excited",
    "quiet",
    "noisy",
    "loud",
    "silent",
    "busy",
    "idle",
    "active",
    "passive",
    "alive",
    "dead",
    "living",
    "dying",
    "healthy",
    "sick",
    "ill",
    "well",
    "fine",
    "terrible",
    "wonderful",
    "excellent",
    "awful",
    "perfect",
    "imperfect",
    "complete",
    "incomplete",
    "whole",
    "partial",
    "entire",
    "half",
    "full",
    "empty",
    "abundant",
    "scarce",
    "sufficient",
    "insufficient",
    "adequate",
    "inadequate",
    "enough",
    "too much",
    "excessive",
    "moderate",
    "extreme",
    "gentle",
    "violent",
    "mild",
    "severe",
    "tender",
    "harsh",
    "kind",
    "cruel",
    "generous",
    "stingy",
    "brave",
    "cowardly",
    "bold",
    "timid",
    "careful",
    "careless",
    "cautious",
    "reckless",
    "wise",
    "foolish",
    "clever",
    "stupid",
    "intelligent",
    "ignorant",
    "smart",
    "dumb",
    "skillful",
    "clumsy",
    "polite",
    "rude",
    "friendly",
    "hostile",
    "kind",
    "mean",
    "honest",
    "dishonest",
    "sincere",
    "insincere",
    "loyal",
    "disloyal",
    "faithful",
    "unfaithful",
    "patient",
    "impatient",
    "tolerant",
    "intolerant",
    "strict",
    "lenient",
    "severe",
    "mild",
    "serious",
    "funny",
    "solemn",
    "humorous",
    "formal",
    "informal",
    "casual",
    "official",
    "public",
    "private",
    "personal",
    "general",
    "specific",
    "particular",
    "individual",
    "collective",
    "single",
    "multiple",
    "various",
    "diverse",
    "uniform",
    "different",
    "same",
    "similar",
    "dissimilar",
    "equal",
    "unequal",
    "identical",
    "distinct",
    "separate",
    "combined",
    "mixed",
    "pure",
    "safe",
    "dangerous",
    "secure",
    "insecure",
    "stable",
    "unstable",
    "steady",
    "unsteady",
    "firm",
    "weak",
    "solid",
    "liquid",
    "thick",
    "thin",
    "dense",
    "sparse",
  ],
  Angka: [
    "one",
    "two",
    "three",
    "four",
    "five",
    "six",
    "seven",
    "eight",
    "nine",
    "ten",
    "hundred",
    "thousand",
    "million",
    "billion",
  ],
  Umum: [], // default type
};

function determineCategory(meaning) {
  const meaningLower = meaning.toLowerCase();

  for (const [category, keywords] of Object.entries(categoryKeywords)) {
    if (category === "Umum") continue;

    for (const keyword of keywords) {
      if (meaningLower.includes(keyword)) {
        return category;
      }
    }
  }

  return "Umum";
}

function determineWordType(meaning) {
  const meaningLower = meaning.toLowerCase();

  // Check for numbers first
  if (wordTypeKeywords["Angka"].some((num) => meaningLower.includes(num))) {
    return "Angka";
  }

  // Check for adjectives (sifat)
  if (
    wordTypeKeywords["Kata Sifat"].some((adj) => meaningLower.includes(adj))
  ) {
    return "Kata Sifat";
  }

  // Check for verbs (kerja)
  if (
    wordTypeKeywords["Kata Kerja"].some((verb) => meaningLower.includes(verb))
  ) {
    return "Kata Kerja";
  }

  // Check for nouns (benda)
  if (
    wordTypeKeywords["Kata Benda"].some((noun) => meaningLower.includes(noun))
  ) {
    return "Kata Benda";
  }

  return "Umum";
}

async function main() {
  try {
    console.log("ğŸš€ Starting kanji category and word type addition...\n");

    // Step 1: Add new columns if they don't exist
    console.log("ğŸ“‹ Step 1: Adding new columns...");
    await pool.query(`
      ALTER TABLE kanji 
      ADD COLUMN IF NOT EXISTS category VARCHAR(100),
      ADD COLUMN IF NOT EXISTS word_type VARCHAR(50);
    `);
    console.log("âœ… Columns added successfully!\n");

    // Step 2: Fetch all kanji data
    console.log("ğŸ“š Step 2: Fetching all kanji data...");
    const result = await pool.query(
      "SELECT id, character, meaning_en FROM kanji ORDER BY id"
    );
    const kanjiList = result.rows;
    console.log(`âœ… Found ${kanjiList.length} kanji records\n`);

    // Step 3: Process and update each kanji
    console.log("ğŸ”„ Step 3: Analyzing and updating kanji...");
    let updated = 0;
    let skipped = 0;

    for (const kanji of kanjiList) {
      if (!kanji.meaning_en) {
        console.log(
          `âš ï¸  Skipping ${kanji.character} (ID: ${kanji.id}) - No English meaning`
        );
        skipped++;
        continue;
      }

      const category = determineCategory(kanji.meaning_en);
      const wordType = determineWordType(kanji.meaning_en);

      await pool.query(
        "UPDATE kanji SET category = $1, word_type = $2 WHERE id = $3",
        [category, wordType, kanji.id]
      );

      updated++;

      if (updated % 50 === 0) {
        console.log(`   âœ“ Processed ${updated} kanji...`);
      }
    }

    console.log(`\nâœ… Step 3 completed!`);
    console.log(`   - Updated: ${updated} kanji`);
    console.log(`   - Skipped: ${skipped} kanji\n`);

    // Step 4: Show statistics
    console.log("ğŸ“Š Step 4: Category statistics:");
    const categoryStats = await pool.query(`
      SELECT category, COUNT(*) as count 
      FROM kanji 
      WHERE category IS NOT NULL 
      GROUP BY category 
      ORDER BY count DESC
    `);

    console.log("\nğŸ“Œ Categories:");
    categoryStats.rows.forEach((row) => {
      console.log(`   ${row.category}: ${row.count} kanji`);
    });

    console.log("\nğŸ“Š Word type statistics:");
    const wordTypeStats = await pool.query(`
      SELECT word_type, COUNT(*) as count 
      FROM kanji 
      WHERE word_type IS NOT NULL 
      GROUP BY word_type 
      ORDER BY count DESC
    `);

    console.log("\nğŸ“Œ Word Types:");
    wordTypeStats.rows.forEach((row) => {
      console.log(`   ${row.word_type}: ${row.count} kanji`);
    });

    console.log("\nğŸ‰ Process completed successfully!");
  } catch (error) {
    console.error("âŒ Error:", error);
    throw error;
  } finally {
    await pool.end();
  }
}

main();
